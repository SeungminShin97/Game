<!DOCTYPE html>
<html lang="ko" layout:decorate="~{layout/basic}" xmlns:layout="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<th:block layout:fragment="title">
    <title>Homepage</title>
</th:block>

<th:block layout:fragment="contentFragment">
    <div class="categoryName">
        <p id="categoryName" th:text="전체글" style="font-size: 20px;"></p>
    </div>
    <div class="content">
        <section>
            <!--/* 검색 */-->
            <div>
                <form id="searchForm" >
                    <select id="searchType" name="searchType" title="검색 유형 선택">
                        <option value="">전체 검색</option>
                        <option value="title">제목</option>
                        <option value="content">내용</option>
                        <option value="writer">작성자</option>
                    </select>
                    <select id="categoryType" name="categoryType" title="게시판 선택">

                    </select>
                    <input type="text" id="keyword" name="keyword" placeholder="키워드를 입력해 주세요." title="키워드 입력" />
                    <button type="button" onclick="movePage(1);"><i class="fas fa-search"></i><span class="skip_info">검색</span></button>
                </form>
            </div>

            <!--/* 리스트 */-->
            <table>
                <colgroup>
                    <col style="width:7.5%;"/><col style="width:auto;"/><col style="width:15%;"/><col style="width:15%;"/><col style="width:7.5%;"/>
                </colgroup>
                <thead>
                <tr>
                    <th scope="col">id</th>
                    <th scope="col">제목</th>
                    <th scope="col">작성자</th>
                    <th scope="col">등록일</th>
                    <th scope="col">조회수</th>
                </tr>
                </thead>

                <!--/* 리스트 데이터 렌더링 영역 */-->
                <tbody id="list">

                </tbody>
            </table>

            <!--/* 페이지네이션 렌더링 영역 */-->
            <div class="paging">

            </div>

            <!--/* 버튼 */-->
            <a type="button" th:text="글쓰기" th:href="@{/post/write}"></a>
        </section>
    </div>
</th:block>

<th:block layout:fragment="js">
<script th:inline="javascript">
/*<![CDATA[*/
    window.onload = () => {
        drawPostList([[${postList}]]);
    }

    $(document).ready(function($) {
        // 카테고리 클릭 이벤트
        $(".categoryClass").click(function(event) {
            updateSelectedLink($(this));
            updatePostList($(this));
            document.getElementById('categoryName').text = $(this).text();
        }).hover(function() {
            $(this).toggleClass("hovered");
        });
    })



    // 선택한 카테고리 업데이트
    function updateSelectedLink($link) {
        $(".categoryClass").removeClass("selected");
        $link.addClass("selected");
    }

    // 선택한 카테고리 게시글 출력
    function updatePostList($link) {
        const selectedCategoryName = $link.text();

        $.ajax({
            type: "GET",
            url: "/post/list/" + selectedCategoryName,
            dataType: 'json',
            success : function (requestList) {
                drawPostList(requestList);
            }
        });
    }

    // 게시글 리스트 그리기
    function drawPostList(list) {
        let html = '';

        list.forEach(t => {
            html += `
                <tr>
                    <td><a onclick="goViewPage(${t.id})">${t.id}</a></td>
                    <td><a onclick="goViewPage(${t.id})">${t.title}</a></td>
                    <td>${t.writer}</td>
                    <td>${dayjs(t.createdDate).format('YYYY-MM-DD')}</td>
                    <td>${t.viewCnt}</td>
                </tr>
                `
        });

        document.getElementById('list').innerHTML = html;
    }


    // view 페이지 이동
    function goViewPage(postId) {
        const url = "/post/view/" + postId;
        window.location.href = url;
    }


/*]]>*/
</script>
</th:block>


</html>